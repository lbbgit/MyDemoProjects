g_obj_map.put("main",this);g_gmain=this;
var gVersion=4,lang="zh",facebook_inited=0,max_main_msg_count=500,gConnected=0,sock=0,gMustRefresh=0,gRecvNetWork2=0,gTimeSec=3,is_fighting=0,notifyStartTop=0,notifyEndTop=0,notifyLeft=0,notifyMoveLong=100,is_reging=0,is_chatting=0,is_lineing=0,is_exercising=0,gHtop=0,out2_msg=0,notify_fail_call_out=0,notify_fail_obj=[],chatMsg=[],cmdHtml="",g_area_id="1",g_delay_connect=0,g_save_chat_cache=0,g_m_auto_cmd=0,g_timeout_tm=0,g_combat_chat=0,g_combat_msg="",g_have_decoder=0,g_text_decoder=0;
$.fn.extend({ProgressBarWars:function(a){var e=$(this).attr("id"),f=Date.now(),g="";defaults={porcentaje:"100",tiempo:1E3,color:"",estilo:"yoda",tamanio:"30%",alto:"1px"};a=$.extend({},defaults,a);""!=a.color&&(g="<style>.color"+f+"{ border-radius: 1px;display: block; width: 0%; box-shadow:0px 0px 1px 1px "+a.color+", 0 0 1px "+a.color+", 0 0 1px "+a.color+", 0 0 1px "+a.color+", 0 0 1px "+a.color+", 0 0 1px "+a.color+", 0 0 1px "+a.color+";background-color: #fff;}</style>",a.estilo="color"+f);$(this).before(g);
$(this).append('<span class="barControl" style="width:'+a.tamanio+';"><div class="barContro_space"><span class="'+a.estilo+'" style="height: '+a.alto+';"  id="bar'+e+'"></span></div></span>');$("#bar"+e).animate({width:a.porcentaje+"%"},a.tiempo);this.mover=function(c){$("#bar"+$(this).attr("id")).animate({width:c+"%"},a.tiempo)};return this}});
function launchFullScreen(a){a.requestFullScreen?a.requestFullScreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullScreen&&a.webkitRequestFullScreen()}function cancelFullscreen(){document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()}
function getstyle(a){var e,f=0;navigator&&navigator.userAgent&&-1<navigator.userAgent.toLowerCase().indexOf("firefox")&&(f=1);for(var g=0;g<document.styleSheets.length;g++){if(f&&(e=document.styleSheets[g].href)&&-1==e.indexOf("main"))continue;if(e=document.styleSheets[g].cssRules?document.styleSheets[g].cssRules:document.styleSheets[g].rules)for(var c=0;c<e.length;c++)if(e[c].selectorText==a)return e[c].style}}function recvNetWork(a,e){this.writeServerData(a,1,0,e)}
function recvNetWork2(a){if(!is_fighting){var e=$("div#out2");e.children("span.out2").length>max_main_msg_count&&e.children("span.out2:lt("+Math.ceil(2*max_main_msg_count/5)+")").remove();0==notify_fail_obj.length&&0<e.children("p").length&&e.children("p").remove()}this.writeServerData(a,2)}function recvNetWorkBottom(a){this.writeServerData(a,2,1)}function recvNetWorkTop(a){this.writeServerData(a,3)}function mustRefresh(){this.gMustRefresh=1}
function writeToScreen(a,e,f,g){1==e?(e=$("div#out"),g?e.append('<span class="out_line">'+a+"</span>"):e.append('<span class="out">'+a+"</span>")):2==e?is_fighting?f?(g=$("div#out2"),g.append('<span class="out2">'+a+"</span>")):(out2_msg||(out2_msg=""),out2_msg+='<span class="out2">'+a+"</span>"):(g=$("div#out2"),g.append('<span class="out2">'+a+"</span>"),g.scrollTop(g.prop("scrollHeight"))):$("div#out_top").append('<span class="out_top">'+a+"</span>")}
function writeServerData(a,e,f,g){a=change_html(a);writeToScreen(a,e,f,g)}function change_html(a){for(var a=gSocketMsg.checkCmd(a),e="",a=a.replace(/\t/g,"&nbsp;&nbsp;&nbsp;"),a=ansi_up.ansi_to_html(a),a=a.split("\n"),f=0;f<a.length;f++){var g=a[f].replace(/\s\s/g,"&nbsp;");f<a.length-1&&(g+="<br/>");e+=g}return e}
function fight(a){a!=is_fighting&&(this.is_chatting&&gSocketMsg.quit_chat(),is_fighting=a,g_gmain.adjustLayout(),is_fighting?(clear_notify_fail(),out2_msg=$("div#out2").html(),$("div#out2").html("")):out2_msg&&(a=$("div#out2"),a.html(out2_msg),a.scrollTop(a.prop("scrollHeight")),out2_msg=0))}function reg(a){a!=is_reging&&(is_reging=a,g_gmain.adjustLayout(),out=$("div#out"),out.html(""))}function chat(a){a!=is_chatting&&(is_chatting=a,g_gmain.adjustLayout(),out=$("div#out"),out.html(""))}
function line(a){a!=is_lineing&&(is_lineing=a,g_gmain.adjustLayout(),out=$("div#out"),out.html(""))}function exercise(a){a!=is_exercising&&(is_exercising=a,g_gmain.adjustLayout(),out=$("div#out"),out.html(""))}function orient(){return 180==window.orientation|0==window.orientation?1:90==window.orientation||-90==window.orientation?0:-1}function getScreenHeight(){return"twan"==g_partner&&0==orient()?window.screen.availWidth:$(window).height()}
function getScreenWidth(a){var e;"twan"==g_partner?(e=orient(),e=1==e?window.screen.availWidth:0==e?window.screen.availHeight:$(window).width()):e=$(window).width();a||(a=getScreenHeight(),e>a&&(e=Math.floor(0.68*a)));return e}var gIsAppStore=0;function isAppStore(){try{return-1!=navigator.userAgent.indexOf("AppStore")?1:0}catch(a){}return 0}var g_old_w=0;
function adjustLayout(){var a=getScreenWidth(),e=getScreenHeight(),f=Math.floor(a/4-5),g=Math.floor(0.36*f),c,d,h,b,i,j,k,l,m=0;0<g_old_w&&0<gHtop&&(d=a/g_old_w,1!=d&&(gHtop=Math.floor(gHtop*d)));g_old_w=a;1==is_fighting?(b=70,c=180,d=e-b-c-3,j=l=h=0,i=k=1):2==is_fighting?(b=120,c=230,d=e-b-c-3,j=l=h=0,i=k=1):is_reging?(b=0,d=e-4,i=j=l=h=c=0,k=1):is_chatting?(b=1.5*(Math.floor(0.446*(a/5))+Math.floor(0.255*(a/4-8))),c=0,h=Math.floor(1.8*g),d=e-b-c-h-4,l=0,i=k=j=1):is_lineing?(h=c=b=0,d=e-b-c-h-4,
l=0,i=k=j=1):is_exercising?(b=Math.floor(0.446*Math.floor(a/5))+5,c=0,h=Math.floor(1.8*g),d=e-b-c-h-4,l=0,i=k=j=1):(b=gHtop,c=e-b-g-5,d=Math.floor(3*c/4),c-=d,h=e-b-d-c-4,i=0<b?1:0,k=j=l=1);notifyStartTop=Math.floor(0+d/2);notifyEndTop=notifyStartTop-notifyMoveLong;notifyLeft=Math.floor(a/2);$("div#out_top").css({width:a-2+"px",height:b+"px","border-left":i+"px solid "+g_border_color,"border-right":i+"px solid "+g_border_color,"border-top":i+"px solid "+g_border_color,"border-bottom":"0px solid "+
g_border_color});$("div#out").css({width:a-2+"px",height:d+"px",border:k+"px solid "+g_border_color});$("div#out2").css({width:a-2+"px",height:c+"px",border:l+"px solid "+g_border_color});$("div#cmd").css({width:a-2+"px",height:h+"px","border-left":"1px solid "+g_border_color,"border-right":"1px solid "+g_border_color,"border-top":"0px solid "+g_border_color,"border-bottom":j+"px solid "+g_border_color});(b=getstyle("body, div#page"))&&(b["background-size"]=""+a+"px "+e+"px");if(b=getstyle("input.reg_input"))b.width=
""+Math.floor(a/2)+"px",b.height=""+Math.floor(g/2)+"px";if(b=getstyle("input.chat_input"))b.width=""+Math.floor(65*a/100)+"px",b.height=""+Math.floor(g/2)+"px";if(b=getstyle("input.tell_input"))b.width=""+Math.floor(34*a/100)+"px",b.height=""+Math.floor(g/2)+"px";if(b=getstyle("button.reg_button"))c=Math.floor(a/4-6),d=Math.floor(0.37*c),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("img.mainb"))b.width=""+f+"px",b.height=""+g+"px";if(b=getstyle("button.cmd_main_quest"))c=Math.floor(a/3-10),
d=Math.floor(0.36*c),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_main_quest2"))c=Math.floor(a/3-10),d=Math.floor(0.36*c),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_main_jh"))c=Math.floor(a/3-10),d=Math.floor(0.36*c),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_main_shimen"))c=Math.floor(a/3-10),d=Math.floor(0.36*c),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_main_baishi"))c=Math.floor(a/3-10),d=Math.floor(0.36*c),b.width=
""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_main_shop"))c=Math.floor(a/6-5),d=Math.floor(1.65*c),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_main_sort"))c=Math.floor(a/6-5),d=Math.floor(1.65*c),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_main_swords"))c=Math.floor(a/6-5),d=Math.floor(1.65*c),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_main_wshop"))c=Math.floor(a/6-5),d=Math.floor(1.65*c),b.width=""+c+"px",b.height=""+d+"px";if(b=
getstyle("button.cmd_main_shejiao"))c=Math.floor(a/6-5),d=Math.floor(1.65*c),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_main_clan"))c=Math.floor(a/6-5),d=Math.floor(1.65*c),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("img.menpai"))c=Math.floor(a-25),d=Math.floor(0.2239*c),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("img.qbutton"))c=Math.floor(a/3-10),d=Math.floor(0.36*c),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("img.sbutton"))c=Math.floor(a/6-5),d=Math.floor(1.65*
c),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("img.prev"))c=Math.floor(a/5),d=Math.floor(0.446*c),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("img.prev_out"))d=Math.floor(21),c=Math.floor(d/0.446),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("img.line"))c=Math.floor(7*a/8),d=Math.floor(2),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("img.all_line"))c=Math.floor(a),d=Math.floor(2),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("img.loading"))c=Math.floor(a/5),d=Math.floor(c),
m=c,b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("img.list"))c=a-10,d=Math.floor(0.1471*c),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("#tr_quest_list"))c=a-10,d=Math.floor(0.2222*c),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_lit"))c=Math.floor(a/5),d=Math.floor(0.2943*c),b.width=""+c+"px",b.height=""+d+"px",b["font-size"]="12px";if(b=getstyle("button.cmd_med"))c=Math.floor(a/4),d=Math.floor(0.32*c),b.width=""+c+"px",b.height=""+d+"px",b["font-size"]=""+Math.max(d-
10,14)+"px";if(b=getstyle("button.cmd_forward"))c=Math.floor(a/7),d=Math.floor(1.1034*c),b.width=""+c+"px",b.height=""+d+"px",b["font-size"]=""+Math.max(d-10,14)+"px";if(b=getstyle("button.cmd_back"))c=Math.floor(a/7),d=Math.floor(1.1034*c),b.width=""+c+"px",b.height=""+d+"px",b["font-size"]=""+Math.max(d-6,14)+"px";if(b=getstyle("button.cmd_fclick"))c=Math.floor(a/8),d=Math.floor(0.9597*c),b.width=""+c+"px",b.height=""+d+"px",b["font-size"]=""+Math.max(d/2,16)+"px";if(b=getstyle("button.cmd_quest"))c=
Math.floor(a/3),d=Math.floor(0.1754*c),b.width=""+c+"px",b.height=""+d+"px",b["font-size"]=""+Math.max(d-4,12)+"px";if(b=getstyle("button.cmd_list"))c=Math.floor(a-20),d=Math.floor(0.1471*c),b.width=""+c+"px",b.height=""+d+"px",b["font-size"]=""+Math.max(d,14)+"px";if(b=getstyle("button.cmd_click"))c=Math.floor(a/4-10),b.width=""+c+"px";if(b=getstyle("button.cmd_click1"))c=Math.floor(a/4-10),d=Math.floor(1*c),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_click2"))c=Math.floor(a/5-
5),d=Math.floor(1*c),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_click2_find"))c=Math.floor(a/5-5),d=Math.floor(1*c),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_click3"))c=Math.floor(a/4-8),d=Math.floor(0.37*c),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_click3_disabled"))c=Math.floor(a/4-8),d=Math.floor(0.37*c),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_click3_find"))c=Math.floor(a/4-6),d=Math.floor(0.37*c),b.width=""+c+
"px",b.height=""+d+"px";if(b=getstyle("button.cmd_click_exits"))c=Math.floor(a/4-10),d=Math.floor(0.37*c),b.width=""+c+"px",b.height=""+d+"px";c=Math.floor(a/3.5-10);d=Math.floor(0.454*c);if(b=getstyle("button.cmd_click_room"))b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_click_exits_e"))b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_click_exits_s"))b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_click_exits_w"))b.width=""+c+"px",b.height=""+d+"px";
if(b=getstyle("button.cmd_click_exits_n"))b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_click_exits_se"))b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_click_exits_sw"))b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_click_exits_nw"))b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_click_exits_ne"))b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_click_exits_e2"))b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_click_exits_s2"))b.width=
""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_click_exits_w2"))b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_click_exits_n2"))b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_click_exits_se2"))b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_click_exits_sw2"))b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_click_exits_nw2"))b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_click_exits_ne2"))b.width=""+c+"px",b.height=
""+d+"px";if(b=getstyle("table.tab"))c=Math.floor(a),d=Math.floor(0.1*c),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_tab"))c=Math.floor(a/4-5),d=Math.floor(0.255*c),b.width=""+c+"px",b.height=""+d+"px",b["font-size"]=""+Math.max(d-6,12)+"px";if(b=getstyle("button.cmd_tab_clicked"))c=Math.floor(a/4-5),d=Math.floor(0.255*c),b.width=""+c+"px",b.height=""+d+"px",b["font-size"]=""+Math.max(d-6,12)+"px";if(b=getstyle("button.cmd_tab_jm2"))c=Math.floor(a/4),d=Math.floor(30*c/160),b.width=
""+c+"px",b.height=""+d+"px",b["font-size"]=""+Math.max(d-6,12)+"px";if(b=getstyle("button.cmd_tab_jm2_clicked"))c=Math.floor(a/4),d=Math.floor(30*c/160),b.width=""+c+"px",b.height=""+d+"px",b["font-size"]=""+Math.max(d-6,12)+"px";if(b=getstyle("button.cmd_tab_jm2_disabled"))if(c=Math.floor(a/4),d=Math.floor(30*c/160),b.width=""+c+"px",b.height=""+d+"px",b["font-size"]=""+Math.max(d-6,12)+"px",f=getstyle("tr.cmd_tab_jm2_top"))f.height=""+d/4+"px";if(b=getstyle("button.cmd_chat_tab"))c=Math.floor(a/
6-5),d=Math.floor(Math.max(0.255*c,15)),b.width=""+c+"px",b.height=""+d+"px",b["font-size"]=""+Math.max(d-6,12)+"px";if(b=getstyle("button.cmd_chat_tab_click"))c=Math.floor(a/6-5),d=Math.floor(Math.max(0.255*c,15)),b.width=""+c+"px",b.height=""+d+"px",b["font-size"]=""+Math.max(d-6,12)+"px";if(b=getstyle("button.cmd_skill_button"))c=Math.min(Math.floor(a/4-10),Math.floor(60/0.37)),d=Math.floor(0.37*c),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.combat_auto_fight"))c=Math.min(Math.floor(a/
4-10),Math.floor(60/0.3276)),d=Math.floor(0.3276*c),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.combat_no_auto_fight"))c=Math.min(Math.floor(a/4-10),Math.floor(60/0.3276)),d=Math.floor(0.3276*c),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.combat_byebye"))c=Math.min(Math.floor(a/4-10),Math.floor(60/0.3276)),d=Math.floor(0.3276*c),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_out_map"))c=Math.floor(a/5),d=Math.floor(0.446*c),b.width=""+c+"px",b.height=
""+d+"px";if(b=getstyle("button.cmd_map"))c=Math.floor(a/5),d=Math.floor(0.446*c),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("button.cmd_change_line"))d=Math.floor(21),c=Math.floor(d/0.446),b.width=""+c+"px",b.height=""+d+"px";if(b=getstyle("select.enable"))c=Math.floor(a/3),d=Math.floor(20),b.width=""+c+"px",b.height=""+d+"px";if(f=document.getElementById("img_loading"))f.style.position="absolute",f.style.left=""+Math.floor(a/2-m/2)+"px",f.style.top=""+Math.floor(e/5)+"px"}
function goFullScreen(){g_gmain.launchFullScreen(document.documentElement)}function send(a){sock&&sock.emit("stream",a)}var g_user_id=0;
function get_user_id(){if(g_user_id)return g_user_id;if("twan"==g_partner)return g_user_id=getUrlAttr(document.location.href,"id");if(g_user_id=getUrlAttr(document.location.href,"id"))return gCookie.setCookie("g_user_id",g_user_id),g_user_id;var a=gCookie.getCookie("user");return a&&(a=a.split("|"),4<=a.length&&1<a[0].length)?(g_user_id=a[0],gCookie.setCookie("g_user_id",g_user_id),a[0]):(a=gCookie.getCookie("g_user_id"))?g_user_id=a:0}var g_user_pwd=0;
function get_user_pwd(){if(g_user_pwd)return g_user_pwd;if("twan"==g_partner)return g_user_pwd=getUrlAttr(document.location.href,"key");if(g_user_pwd=getUrlAttr(document.location.href,"key"))return gCookie.setCookie("g_user_pwd",g_user_pwd),g_user_pwd;var a=gCookie.getCookie("user");return a&&(a=a.split("|"),4<=a.length&&1<a[1].length)?(g_user_pwd=a[1],gCookie.setCookie("g_user_pwd",g_user_pwd),a[1]):(a=gCookie.getCookie("g_user_pwd"))?g_user_pwd=a:0}var g_s_line=0;
function get_s_line(){if(g_s_line)return g_s_line;if("twan"==g_partner)return g_s_line=getUrlAttr(document.location.href,"s_line");if(g_s_line=getUrlAttr(document.location.href,"s_line"))return g_s_line;var a=gCookie.getCookie("user");return a&&(a=a.split("|"),4<=a.length)?(g_s_line=a[2],a[2]):(a=gCookie.getCookie("g_s_line"))?g_s_line=a:0}var g_time=0;
function get_time(){if(g_time)return g_time;if("twan"==g_partner)return g_time=getUrlAttr(document.location.href,"time");if(g_time=getUrlAttr(document.location.href,"time"))return gCookie.setCookie("g_time",g_time),g_time;var a=gCookie.getCookie("user");return a&&(a=a.split("|"),4<=a.length)?(g_time=a[3],gCookie.setCookie("g_time",g_time),a[3]):(a=gCookie.getCookie("g_time"))?g_time=a:0}
function getUrlAttr(a,e){if(!a)return 0;var f=a.split("?");if(2>f.length)return 0;for(var f=f[1].split("&"),g,c=0;c<f.length;c++)if(g=f[c].split("="),!(2>g.length)&&g[0]==e)return decodeURIComponent(g[1]);return 0}function getDomain(a){if(!a)return 0;a=a.split(".");if(2>a.length)return 0;a=a[0].split("//");return 2>a.length?a[0]:a[1]}function getMainHost(a){if(!a)return 0;a=a.split("//");a=2>a.length?a[0]:a[1];a=a.split("/");return a[0]}
function replaceDomain(a){if(!a)return a;var e;e=document.location.href.split("//");e=1<e.length?e[1]:e[0];e=e.split("/");e=e[0];"sword_server1_360.yytou.cn"==e?a=a.replace("sword_server1.yytou.cn",e):"sword_server2_360.yytou.cn"==e?a=a.replace("sword_server2.yytou.cn",e):"swordserver1qq.yytou.cn"==e?a=a.replace("sword_server1.yytou.cn",e):"swordserver2qq.yytou.cn"==e&&(a=a.replace("sword_server2.yytou.cn",e));return a}
function login(){if("undefined"==typeof gSocketMsg2)return 0;var a=document.location.href;if("twan"!=g_partner)if("undefined"!=typeof isWeixinBroswer&&isWeixinBroswer()){var e=parseInt(getUrlAttr(a,"s_line"));if(a&&(getUrlAttr(a,"key")&&0!=e)&&(e=a.split("?"),0<e.length)){get_user_id();get_user_pwd();get_s_line();get_time();var e=e[0],f=e.split(":");3<=f.length&&(e="http:"+f[1]);e+="?s_line="+getUrlAttr(a,"s_line");e+="&time="+getUrlAttr(a,"time");document.location.href=e;return 0}}else if(e=getMainHost(a))if(f=
g_obj_map.get("msg_status"))if(f=f.get("port"))if(f=parseInt(f),0<f&&-1==e.indexOf(":")&&-1!=e.indexOf("sword-direct"))return a=a.replace(e,e+":"+f),document.location.href=a,0;e=get_s_line();if(!e||"0"==e){if(!getUrlAttr(a,"area")&&"twan"!=g_partner&&"http://res.yytou.cn/lunjian/"==g_js_host)return document.location.href=get_entry_url(),0;line(1);g_gmain.adjustLayout();gSocketMsg.show_lines_page();return 0}line(0);g_gmain.adjustLayout();return(e=get_user_id())?(a=g_gmain.getUrlAttr(a,"arg"),!a||0==
a.length?a=0:(f=a.split("_"),2<=f.length&&(a=f[0])),g_world_uid&&0<g_world_uid.length&&(e=g_world_uid),f="js",gIsAppStore&&(f+="appstore"),e="login "+f+":"+e+":"+get_time(),e+="_"+a+"_"+gVersion,e+=" "+get_user_pwd()+"\n",send(e),1):0}
function clickButton(a,e){if(a&&!(0==a.length||"none"==a||""==a||"0"==a)){var f=a.split(" "),g,c;0<f.length?(g=f[0],c=f.slice(1).join(" ")):(g=a,c="");var d=g_obj_map.get("msg_attrs"),h;h=d?parseInt(d.get("lvl")):1;var b=0;if(d){if(b=d.get("master_id"),""==b||"0"==b)b=0}else b=0;if("fullScreen"==g)g_gmain.goFullScreen();else if("score_base"==g)gSocketMsg.show_score();else if("score_info"==g)gSocketMsg.show_score_info();else if("prev"==g)gSocketMsg.showPrev();else if("prev_combat"==g)gSocketMsg.showPrev(),
$("div#out").scrollTop(0),gSocketMsg._page_scrollTop=0;else if("jhgo"==g)gSocketMsg.jh_go(1<f.length?f[1]:"");else if("fbgo"==g)gSocketMsg.fb_go(1<f.length?f[1]:"");else if("jhselect"==g)gSocketMsg.jh_select();else if("fbselect"==g)gSocketMsg.fb_select();else if("my_skills"==g)gSocketMsg.show_skills(0,1<f.length?f[1]:"");else if("show_my_skills"==g)gSocketMsg.show_skills(0);else if("shopinfo"==g)0<f.length&&(d=g_obj_map.get("msg_shops"))&&d.put("selected",f[1]),gSocketMsg.show_shop_info();else if("swords_shopinfo"==
g)0<f.length&&(d=g_obj_map.get("msg_swords_shop"))&&d.put("selected",f[1]),gSocketMsg.show_swords_shop_info();else if("sortinfo"==g)0<f.length&&(d=g_obj_map.get("msg_sorts"))&&d.put("selected",f[1]),gSocketMsg.show_sort_info();else if("buyinfo"==g)0<f.length&&(d=g_obj_map.get("msg_buys"))&&d.put("selected",f[1]),gSocketMsg.show_buy_info();else{if("enableskill"==g)if(1<c.length)send(c+"\n"),clickButton("enable");else return;else{if("show_enable"==g){3<=f.length&&enable_select_click(f[1],f[2]);return}if("go_chat"==
g){if(15>h){g_gmain.notify_fail("15\u7ea7\u5f00\u653e\u6b64\u529f\u80fd\u3002");return}0==c.length?gSocketMsg.show_channel():gSocketMsg.show_channel(c);return}if("goscore"==g){if(7>h){g_gmain.notify_fail("7\u7ea7\u5f00\u653e\u6b64\u529f\u80fd\u3002");return}a="score"}else if("golook_room"==g){if(!b&&100>h){g_gmain.notify_fail("\u62dc\u5e08\u540e\u5f00\u653e\u6b64\u529f\u80fd\u3002");return}a="look_room"}else if("gohome"==g)a="home";else{if("cancel_tell"==g){gSocketMsg.cancel_tell();return}if("send_chat"==
g){gSocketMsg.send_chat();return}if("quit_chat"==g)if(gSocketMsg.quit_chat(),g_combat_chat)gSocketMsg.go_combat(),a="refresh_vs";else return;else{if("quit_exercise"==g){gSocketMsg2.quit_exercise();return}if("telluser"==g){0<c.length&&(gSocketMsg.show_channel(),g_obj_map.put("tell_to_uid",c),gSocketMsg.show_channel("tell"),gSocketMsg.get_chat_bottom_msg());return}if("gopay"==g){gSocketMsg.go_pay();return}if("client_prompt"==g){g=(d=g_obj_map.get("msg_attrs"))?(g=d.get("s_user"))?parseInt(g):0:0;f=
4<=f.length&&0==c.indexOf("home apprentice")?g?"  \u662f\u5426\u786e\u5b9a\u8981\u52a0\u5165\u6b64\u95e8\u6d3e\uff1f\n\n\n\n":"  \u662f\u5426\u786e\u5b9a\u8981\u52a0\u5165"+HIG+f[3]+NOR+"\uff1f\n\n\n\n":3<=f.length&&0==c.indexOf("exercise stop")?"  \u662f\u5426\u786e\u5b9a\u8981\u505c\u6b62\u6253\u5750\uff1f\n\n\n\n":3<=f.length&&0==c.indexOf("work stop")?"  \u662f\u5426\u786e\u5b9a\u8981\u505c\u6b62\u6302\u673a\uff1f\n\n\n\n":3<=f.length&&0==c.indexOf("practice stop")?"  \u662f\u5426\u786e\u5b9a\u8981\u505c\u6b62\u7ec3\u4e60\u6280\u80fd\uff1f\n\n\n\n":
3<=f.length&&0==c.indexOf("tupo stop")?"  \u662f\u5426\u786e\u5b9a\u8981\u505c\u6b62\u7a81\u7834\u6280\u80fd\uff1f\n\n\n\n":"  \u662f\u5426\u786e\u5b9a\u64cd\u4f5c\uff1f\n\n\n\n";g_gmain.send_prompt(f,c,"\u786e\u5b9a",e);return}if("home_prompt"==g)if(gSocketMsg.is_in_home())a="home";else{g_gmain.send_prompt("  \u662f\u5426\u786e\u5b9a\u8981\u79bb\u5f00\u95ef\u8361\u6c5f\u6e56\uff0c\u53bb\u5f80\u6e38\u620f\u4e3b\u9875\uff1f\n\n\n\n","home","\u786e\u5b9a");return}else{if("cancel_prompt"==g){gSocketMsg.showPrev();
return}if("client_map"==g){gSocketMsg.show_map();return}if("client_reload"==g){window.location.reload();return}if("client_apprentice"==g){gSocketMsg.show_family_info(c);return}if("skin_select"==g){c=parseInt(c);if(1>c||3<c)c=1;if("undefined"!=typeof localStorage)try{localStorage.removeItem("game_skin"),localStorage.setItem("game_skin",""+c)}catch(i){}f=document.location.href;f=change_game_skin(f,c);document.location.href=f;return}if("client_exercise"==g){gSocketMsg2.client_exercise_click();return}if("exercise_list"==
g){if("exercise_list click go"==a&&(d=g_obj_map.get("msg_exercise_list"))&&0>=parseInt(d.get("tl"))&&0<gSocketMsg2.g_no_exercise_click){gSocketMsg2.g_no_exercise_click--;return}}else{if("empty_chat"==g){chatMsg=[];gSocketMsg.show_channel();g_save_chat_cache=1;return}if("combat_chat"==g){if(15>h)return;fight(0);g_combat_chat=1;gSocketMsg.show_channel();return}if("show_jm"==g){gSocketMsg2.show_jm(c);return}if("clan_view"==g){gSocketMsg2.show_clan();return}if("clan_members"==g){gSocketMsg2.show_clan_members();
return}if("clan_member_info"==g){0<f.length&&(d=g_obj_map.get("msg_clan_view"))&&d.put("selected_member",f[1]);gSocketMsg2.show_clan_member_info();return}if("clan_shop"==g){gSocketMsg2.show_clan_shop();return}if("clan_role_detail"==g){gSocketMsg2.show_clan_role_detail();return}}}}}}send(a+"\n");"attrs"!=g&&"swords"!=g&&g_gmain.show_loading();if(e){e=parseInt(e);1>e&&(e=1);for(c=0;c<e;c++)gSocketMsg.showPrev()}}}}
function replaceChat(a,e,f){if(0>e||e>=a.length||0==a.length)return a;var g=a.substr(0,e),a=a.substr(e+1,a.length);return g+f+a}function get_game_skin(){var a=getUrlAttr(document.location.href,"game_skin");return!a?3:parseInt(a)}function change_game_skin(a,e){var f;return a=-1!=(f=a.indexOf("game_skin"))?replaceChat(a,f+9+1,""+e):-1!=a.indexOf("?")?a+("&game_skin="+e):a+("?game_skin="+e)}
function send_prompt(a,e,f,g){var c=new Map;c.put("type","prompt");c.put("msg",a);c.put("cmd1",e);c.put("cmd1_name",f);g=g?parseInt(g)+1:0;c.put("close_after_click1",g);g_obj_map.put("msg_prompt",c);gSocketMsg.show_prompt()}function enable_select_change(a){if((a=a.value)&&"none"!=a)clickButton(a,0),clickButton("enable",0)}function enable_select_click(a,e){g_obj_map.put("click_enable_p1",a);g_obj_map.put("click_enable_p2",e);gSocketMsg.show_enable_info()}
function show_loading(){if(!(elem=document.getElementById("img_loading")))return!1;elem.style.display="block";return!0}function hide_loading(){if(!(elem=document.getElementById("img_loading")))return!1;elem.style.display="none";return!0}function try_visit_wx(){var a=g_obj_map.get("msg_login_ret");a&&("twan"==g_partner?tw_visit_wx():(a=g_simul_efun.replace_special_msg4(a.get("wx_visit_url")),0<a.length&&(document.location.href=a)))}
function wx_visit_check(a){$.ajax({url:a,cache:!1,dataType:"json",success:function(a){var f=g_obj_map.get("msg_login_ret");if(f){var g=parseInt(a.subscribe),a=a.ckey;0<g&&(f.put("wx_visit",1),g_gmain.clickButton("share_ok v,"+a))}},error:function(a){console.log(a.statusText)}})}
function check_wx_visit(){var a=g_obj_map.get("msg_login_ret");if(!a)return!1;if("twan"==g_partner)tw_check_visit_wx();else{if(0<parseInt(a.get("wx_visit")))return!0;g_simul_efun.replace_special_msg4(a.get("wx_visit_url"));a=g_simul_efun.replace_special_msg4(a.get("wx_check_url"));0<a.length&&wx_visit_check(a)}}var g_params_url,g_share_link,g_facebook_appid;function try_share(){send("try_share "+document.location.href+"\n")}
function init_share(){("undefined"==typeof g_use_weixin||g_use_weixin)&&"undefined"!=typeof isWeixinBroswer&&isWeixinBroswer()&&initShare({debug:!1,params_url:g_params_url,share_title:"\u3010\u8bba\u5251\uff1a\u6c5f\u6e56\u3011",share_desc:"\u5f00\u653e\u5ea6\u6700\u9ad8\u7684\u6b66\u4fa0\u6587\u5b57\u6e38\u620f\uff0c\u70b9\u51fb\u5373\u73a9\uff0c\u79d2\u52a0\u8f7d\u3002\u5927\u91cf\u8c1c\u9898\uff0c\u4e09\u5341\u4e2a\u95e8\u6d3e\uff0c\u4e94\u5341\u7ae0\u5730\u56fe\uff0c\u65e0\u6bd4\u5e9e\u5927\u7684\u6b66\u4fa0\u4e16\u754c\u7b49\u4f60\u6765\u63a2\u7d22\u3002",
share_link:g_share_link,share_imgurl:"http://res.yytou.cn/lunjian/img/icon1.png",onsuccess:function(a){"Timeline"==a?send("share_ok 1\n"):"AppMessage"==a?send("share_ok 2\n"):"QQ"==a?send("share_ok 3\n"):"Weibo"==a?send("share_ok 4\n"):"QZone"==a&&send("share_ok 5\n")}});if("undefined"!=typeof g_use_facebook&&g_use_facebook){window.fbAsyncInit=function(){FB.init({appId:g_facebook_appid,xfbml:!0,version:"v2.8"});FB.AppEvents.logPageView();facebook_inited=1};var a,e=document.getElementsByTagName("script")[0];
document.getElementById("facebook-jssdk")||(a=document.createElement("script"),a.id="facebook-jssdk",a.src="https://connect.facebook.net/en_US/sdk.js",e.parentNode.insertBefore(a,e))}}
function share_game(a){if((!a||1==a)&&("undefined"==typeof g_use_weixin||g_use_weixin)){"undefined"!=typeof yyWXBridge&&yyWXBridge.wxShareNews(JSON.stringify({where:"Timeline",url:g_share_link,title:"\u8bba\u5251\uff1a\u6c5f\u6e56",desc:"\u5f00\u653e\u5ea6\u6700\u9ad8\u7684\u6b66\u4fa0\u6587\u5b57\u6e38\u620f\uff0c\u70b9\u51fb\u5373\u73a9\uff0c\u79d2\u52a0\u8f7d\u3002\u5927\u91cf\u8c1c\u9898\uff0c\u4e09\u5341\u4e2a\u95e8\u6d3e\uff0c\u4e94\u5341\u7ae0\u5730\u56fe\uff0c\u65e0\u6bd4\u5e9e\u5927\u7684\u6b66\u4fa0\u4e16\u754c\u7b49\u4f60\u6765\u63a2\u7d22\u3002",picurl:"http://res.yytou.cn/lunjian/img/icon1.png"}));
if("twan"==g_partner){tw_share_game();return}"undefined"==typeof isWeixinBroswer||!isWeixinBroswer()?(showShareQRCode(document.location.href),recvNetWork2(HIG+"\u5fae\u4fe1\u626b\u63cf\u4e8c\u7ef4\u7801\u540e\uff0c\u70b9\u53f3\u4e0a\u89d2\u7684\u201c...\u201d\u5206\u4eab\u6e38\u620f\uff0c\u6bcf\u5929\u90fd\u53ef\u4ee5\u83b7\u5f97\u4e00\u7ec4\u5956\u52b1\u3002\u5404\u4e2a\u793e\u4ea4\u6e20\u9053\u5956\u52b1\u4e0d\u540c\uff0c\u5305\u62ec\u5143\u5b9d\u3001\u94f6\u4e24\u3001\u6f5c\u80fd\u7b49\u3002\n"+
NOR)):(notify_fail("\u5206\u4eab\u6e38\u620f\u5230\u5404\u793e\u4ea4\u6e20\u9053\uff0c\u6709\u5143\u5b9d\u5956\u52b1\u54e6\uff01"),recvNetWork2(HIG+"\u8bf7\u70b9\u53f3\u4e0a\u89d2\u7684\u201c...\u201d\u5206\u4eab\u6e38\u620f\uff0c\u6bcf\u5929\u4fdd\u6301\u5206\u4eab\uff0c\u6bcf\u5929\u90fd\u53ef\u4ee5\u83b7\u5f97\u4e00\u7ec4\u5956\u52b1\u3002\u5404\u4e2a\u793e\u4ea4\u6e20\u9053\u5956\u52b1\u4e0d\u540c\uff0c\u5305\u62ec\u5143\u5b9d\u3001\u94f6\u4e24\u3001\u6f5c\u80fd\u7b49\u3002\n"+NOR))}2==a&&("undefined"!=
typeof g_use_facebook&&g_use_facebook)&&(facebook_inited?FB.ui({href:g_share_link,quote:"\u5f00\u653e\u5ea6\u6700\u9ad8\u7684\u6b66\u4fa0\u6587\u5b57\u6e38\u620f\uff0c\u70b9\u51fb\u5373\u73a9\uff0c\u79d2\u52a0\u8f7d\u3002\u5927\u91cf\u8c1c\u9898\uff0c\u4e09\u5341\u4e2a\u95e8\u6d3e\uff0c\u4e94\u5341\u7ae0\u5730\u56fe\uff0c\u65e0\u6bd4\u5e9e\u5927\u7684\u6b66\u4fa0\u4e16\u754c\u7b49\u4f60\u6765\u63a2\u7d22\u3002",hashtag:"#\u8bba\u5251\u6c5f\u6e56",mobile_iframe:!0,method:"share"},function(a){a&&!a.error_message&&
send("share_ok 7\n")}):notify_fail("\u6b63\u5728\u52a0\u8f7dFacebook\u63a7\u4ef6\uff0c\u8bf7\u7a0d\u5019..."))}function addAutoCommand(a,e){var f=new Map;f.put("cmd",a);f.put("sec",e);g_m_auto_cmd=f}var time_loops=0,g_notify_mobile=0;
function timeLoop(){var a,e,f,g;1E4>g_timeout_tm&&(g_timeout_tm-=gTimeSec,0>=g_timeout_tm&&(g_gmain.goThreeServer(),g_timeout_tm=1E5));g_m_auto_cmd&&(e=parseInt(g_m_auto_cmd.get("sec")),e-=gTimeSec,0>=e?((e=g_m_auto_cmd.get("cmd"))&&clickButton(e),g_m_auto_cmd=0):g_m_auto_cmd.put("sec",e));g_notify_mobile||(g_notify_mobile=1,e=getScreenWidth(1),a=getScreenHeight(),e>=a&&g_gmain.notify_fail(HIG+"\u4f7f\u7528\u624b\u673a\u6d4f\u89c8\u5668\u53ef\u76f4\u63a5\u8fdb\u5165\u6e38\u620f"+NOR));g_partner&&
("twan"==g_partner&&!g_partner_inited&&"undefined"!=typeof init_partner)&&(g_partner_inited=1,init_partner());g=0;if(e=g_obj_map.get("msg_work")){e.get("must_r")&&(e.put("must_r2",1),e.remove("must_r"));var c;for(a=1;f=e.get("work"+a);a++)if(list=g_simul_efun.isArray(f)?f:f.split(","),!(10>list.length)&&!(0>=(c=parseInt(list[8]))))c-=gTimeSec,0>c&&(c=0),list[8]=c,e.put("work"+a,list),"work"==gSocketMsg._current_page&&(0==notify_fail_obj.length?g=1:e.put("must_r",1));if("work"==gSocketMsg._current_page&&
(g||e.get("must_r2")))e.remove("must_r2"),gSocketMsg.show_work()}if(e=g_obj_map.get("msg_skill"))if(c=e.get("tupo_tm"))c-=gTimeSec,0>c&&(c=0),e.put("tupo_tm",c),"skill_info"==gSocketMsg._current_page&&gSocketMsg.show_skill_info();(e=g_obj_map.get("msg_swords"))&&!is_fighting&&"swords"==gSocketMsg._current_page&&-1!=e.get("swords_wk").indexOf(e.get("wk"))&&1==time_loops%2&&g_gmain.clickButton("swords");0==++time_loops%20&&clickButton("attrs");g_save_chat_cache&&(g_save_chat_cache=0,gSocketMsg2.save_channel())}
$(window).resize(adjustLayout);function initCommand(){new FastClick(document.body)}function clear_notify_fail(){for(var a=0;a<notify_fail_obj.length;a++)notify_fail_obj[a]&&(notify_fail_obj[a].style.display="none");notify_fail_obj=[]}
function add_notify_fail_obj(a){var e=$("div#out2");notify_id++;var f="notify_"+notify_id,a=HIR+a+NOR,a=change_html(a);e.append("<p id='"+f+"' align='center'><strong style='font-size:18px'>"+a+"</strong></p>");if(!(a=document.getElementById(f)))return!1;notify_fail_obj[notify_fail_obj.length]=a;a.style.position="absolute";a.style.left="20px";a.style.top=""+notifyStartTop+"px";a.style.display="none";notify_fail_call_out||(notify_fail_call_out=setInterval(check_move_notify_fail_obj,32))}
function check_move_notify_fail_obj(){for(var a,e,f=0,g=0;f<notify_fail_obj.length&&2>g;f++,g++)if(a=notify_fail_obj[f],e=parseInt(a.style.top),"none"==a.style.display&&(a.style.display="block"),e<=notifyEndTop)a.style.display="none",notify_fail_obj.splice(f,1),f--;else if(e-=2,a.style.top=e+"px",e>Math.floor(notifyStartTop-notifyMoveLong/2))break;0==notify_fail_obj.length&&(clearInterval(notify_fail_call_out),notify_fail_call_out=0)}var notify_id=0;
function notify_fail(a){if(!document.getElementById)return g_gmain.recvNetWork2(a),!1;10<=notify_fail_obj.length&&clear_notify_fail();add_notify_fail_obj(a);return!0}function goThreeServer(){var a=document.location.href;if(-1==a.indexOf("server"))return 0;a.replace("server","direct");return 1}var g_world_ip=0,g_world_port=0,g_world_uid=0;
function connectServer(){if(!sock)if(0<g_gmain.g_delay_connect)g_gmain.g_delay_connect--;else{var a=getUrlAttr(document.location.href,"ws_host");sock=a?io.connect("http://"+a):g_world_ip?io.connect("http://"+g_world_ip+":"+g_world_port):io.connect();sock.on("stream",function(a){g_have_decoder?gSocketMsg.addMessage(a):gSocketMsg.addMessage2(a)});sock.on("status",function(a){writeServerData(a,2)});sock.on("websocket_connected",function(){console.log("websocket connected");gSocketMsg.clear_msg();if(sock){var a=
getUrlAttr(document.location.href,"ws_host"),a=""+get_s_line()+","+getDomain(a?a:g_world_ip?g_world_ip:document.location.href)+","+gVersion;sock.emit("s_line",a)}});sock.on("telnet_connected",function(){console.log("connected")});sock.on("disconnect",function(){console.log("disconnected");sock.close();sock=0});sock.on("error",function(){console.log("error");sock.close();sock=0})}}var g_chat_msg="";
function sendParentMsg(a){try{window.top!=window.self&&(window.addEventListener("message",function(a){if(a=a.data)g_chat_msg=a,gSocketMsg2.load_channel()},!1),window.parent.postMessage(a,"*"))}catch(e){}}
$(document).ready(function(){g_timeout_tm=10;var a=document.location.href;sendParentMsg(a);lang=gCookie.getCookie("lang");gIsAppStore=isAppStore();(a=getUrlAttr(a,"area"))&&(g_area_id=a);connectServer();initCommand();adjustLayout();gSocketMsg.get_have_no_chat_msg_cmd();gSocketMsg2.load_channel();setInterval(function(){connectServer();g_gmain.gMustRefresh&&(g_gmain.send("look_room\n"),g_gmain.gMustRefresh=0);timeLoop()},1E3*gTimeSec)});
